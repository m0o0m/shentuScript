--天机宝箱物品
settings =
{
    ["转盘次数"]=3, --不能大于转盘上的物品数量
}

AwardGroup =
{
				--Group1
                --KeyName, Rate, Count, Notice
{
{"圣武战靴", 21000000, 1, ""}, 
{"帝释", 50, 1, "s%探索天机罗盘发现了帝释"}, 
{"钱袋(1万)", 1050000000, 1, ""}, 
{"讨伐令", 1050000, 1, ""}, 
{"打捆绳(100个)", 1050000, 1, ""}, 
{"游光之翼(7天)", 21000000, 1, ""}, 
{"坐骑还魂丹", 105000000, 1, ""}, 
{"封印鉴定符", 1050000000, 1, ""}, 
}, 
{
{"十杀", 108000, 1, ""}, 
{"疾雷护腕(神)", 7200, 1, ""}, 
{"修复神水(1次)", 21600000, 1, ""}, 
{"钱袋(20万)", 10800000, 1, ""}, 
{"打捆绳(100个)", 216000, 1, ""}, 
{"1.5倍经验卷轴", 21600000, 1, ""}, 
{"9朵玫瑰花", 24000000, 1, ""}, 
{"封印鉴定符", 216000000, 1, ""}, 
}, 
{
{"苍冥戒指", 2950000, 1, ""}, 
{"碎空", 295, 1, "s%探索天机罗盘发现了碎空"}, 
{"钱袋(2万)", 73750000, 1, ""}, 
{"小喇叭(10个)", 2500000, 1, ""}, 
{"汗血(未开光)", 2950000, 1, ""}, 
{"彩云之翼(7天)", 2950000, 1, ""}, 
{"时之沙砾", 14750000, 1, ""}, 
{"封印鉴定符", 147500000, 1, ""}, 
}, 
{
{"血夜魔靴", 3000, 1, ""}, 
{"火灵护腕(圣)", 200, 1, ""}, 
{"修复神水(1次)", 600000, 1, ""}, 
{"1.5倍经验卷轴", 600000, 1, ""}, 
{"汗血(未开光)", 120000, 1, ""}, 
{"定位石", 600000, 1, ""}, 
{"钱袋(1万)", 6000000, 1, ""}, 
{"封印鉴定符", 6000000, 1, ""}, 
}, 
{
{"飞尘戒指", 28500000, 1, ""}, 
{"圣灵法衣(男)", 75, 1, "s%探索天机罗盘发现了圣灵法衣(男)"}, 
{"钱袋(1万)", 1425000000, 1, ""}, 
{"精炼大礼包", 1425000, 1, ""}, 
{"金条", 950000, 1, ""}, 
{"火焰之翼(7天)", 28500000, 1, ""}, 
{"修复神水(1次)", 142500000, 1, ""}, 
{"封印鉴定符", 1425000000, 1, ""}, 
}, 
{
{"末日战靴", 90000, 1, ""}, 
{"火灵头盔", 6000, 1, ""}, 
{"开光印", 18000000, 1, ""}, 
{"双倍经验卷轴", 9000000, 1, ""}, 
{"金条", 120000, 1, ""}, 
{"时之沙砾", 18000000, 1, ""}, 
{"钱袋(5万)", 36000000, 1, ""}, 
{"封印鉴定符", 180000000, 1, ""}, 
}, 
{
{"灵魂法衣(女)", 2000000, 1, ""}, 
{"赤峰战甲(男)", 75000, 1, ""}, 
{"钱袋(5万)", 600000000, 1, ""}, 
{"修复神水", 60000000, 1, ""}, 
{"独角兽(未开光)", 6000, 1, "s%探索天机罗盘发现了独角兽(未开光)"}, 
{"大型经验丹", 300000000, 1, ""}, 
{"龙城传送石", 300000000, 1, ""}, 
{"封印鉴定符", 3000000000, 1, ""}, 
}, 
{
{"天劫道靴", 60000, 1, ""}, 
{"云扬戒指(神)", 4000, 1, ""}, 
{"开光印", 12000000, 1, ""}, 
{"大型经验丹", 12000000, 1, ""}, 
{"独角兽(未开光)", 240, 1, "s%探索天机罗盘发现了独角兽(未开光)"}, 
{"打捆绳(10个)", 12000000, 1, ""}, 
{"灵元珠", 120000000, 1, ""}, 
{"封印鉴定符", 120000000, 1, ""}, 
}, 
{
{"圣武护腕", 4750000000, 1, ""}, 
{"百裂战甲(男)", 12500, 1, "s%探索天机罗盘发现了百裂战甲(男)"}, 
{"玫瑰花", 237500000000, 1, ""}, 
{"讨伐令", 237500000, 1, ""}, 
{"中级转神石", 237500000, 1, ""}, 
{"邪魔翼(7天)", 4750000000, 1, ""}, 
{"祝福神水", 23750000000, 1, ""}, 
{"高级鉴定灵符", 95000000, 1, ""}, 
}, 
{
{"末日戒指", 17700000, 1, ""}, 
{"疾雷护腕(圣)", 1180000, 1, ""}, 
{"祝福神水", 3540000000, 1, ""}, 
{"低级灵元精粹", 1770000000, 1, ""}, 
{"中级转神石", 35400000, 1, ""}, 
{"定位石", 3540000000, 1, ""}, 
{"小喇叭", 6000000000, 1, ""}, 
{"高级鉴定灵符", 14160000, 1, ""}, 
}, 
{
{"斗士铠甲(女)", 10000000, 1, ""}, 
{"阎罗长袍(男)", 375000, 1, ""}, 
{"灵元精华", 7500000000, 1, ""}, 
{"钱袋(50万)", 300000000, 1, ""}, 
{"绝影(未开光)", 300000000, 1, ""}, 
{"释灵珠", 1500000000, 1, ""}, 
{"清心丹", 1500000000, 1, ""}, 
{"高级鉴定灵符", 6000000, 1, ""}, 
}, 
{
{"天劫道指", 750000, 1, ""}, 
{"云扬项链", 50000, 1, ""}, 
{"祝福神水", 150000000, 1, ""}, 
{"随机传送(50次)", 150000000, 1, ""}, 
{"绝影(未开光)", 30000000, 1, ""}, 
{"修复神水(1次)", 150000000, 1, ""}, 
{"玫瑰花", 1500000000, 1, ""}, 
{"高级鉴定灵符", 600000, 1, ""}, 
}, 
{
{"苍冥头盔", 5700000000, 1, ""}, 
{"太玄道袍(女)", 15000, 1, "s%探索天机罗盘发现了太玄道袍(女)"}, 
{"玫瑰花", 285000000000, 1, ""}, 
{"中级灵元精粹", 4750000000, 1, ""}, 
{"高级转神石", 142500000, 1, ""}, 
{"魔蝶之翼(7天)", 5700000000, 1, ""}, 
{"释灵珠", 28500000000, 1, ""}, 
{"高级鉴定灵符", 114000000, 1, ""}, 
}, 
{
{"血夜魔指", 6000000, 1, ""}, 
{"火灵戒指(神)", 400000, 1, ""}, 
{"龙城传送石", 1200000000, 1, ""}, 
{"钱袋(10万)", 1200000000, 1, ""}, 
{"高级转神石", 6000000, 1, ""}, 
{"随机传送(50次)", 1200000000, 1, ""}, 
{"灵元精华", 6000000000, 1, ""}, 
{"高级鉴定灵符", 4800000, 1, ""}, 
}, 
{
{"龙渊", 405000000, 1, ""}, 
{"疾雷头盔", 27000000, 1, ""}, 
{"9朵玫瑰花", 90000000000, 1, ""}, 
{"逍遥游(100次)", 27000000000, 1, ""}, 
{"吼天兽(未开光)", 1620000, 1, "s%探索天机罗盘发现了吼天兽(未开光)"}, 
{"1.5倍经验卷轴", 81000000000, 1, ""}, 
{"东临城传送石", 81000000000, 1, ""}, 
{"高级鉴定灵符", 324000000, 1, ""}, 
}, 
{
{"鉴定大礼包", 300000, 1, "s%探索天机罗盘发现了鉴定大礼包"}, 
{"云扬戒指(圣)", 5000000, 1, ""}, 
{"龙城传送石", 15000000000, 1, ""}, 
{"定位石", 15000000000, 1, ""}, 
{"吼天兽(未开光)", 300000, 1, "s%探索天机罗盘发现了吼天兽(未开光)"}, 
{"打捆绳(10个)", 15000000000, 1, ""}, 
{"打捆绳", 150000000000, 1, ""}, 
{"高级鉴定灵符", 60000000, 1, ""}, 
}, 
{
{"圣武戒指", 1050000000, 1, ""}, 
{"无常", 2500, 1, "s%探索天机罗盘发现了无常"}, 
{"打捆绳", 52500000000, 1, ""}, 
{"精炼大礼包", 52500000, 1, ""}, 
{"定位石(100次)", 52500000, 1, ""}, 
{"阴影之翼(7天)", 1050000000, 1, ""}, 
{"祝福神水", 5250000000, 1, ""}, 
{"中级鉴定灵符", 1050000000, 1, ""}, 
}, 
{
{"末日项链", 3540000, 1, ""}, 
{"疾雷战靴", 236000, 1, ""}, 
{"释灵珠", 708000000, 1, ""}, 
{"低级转神石", 354000000, 1, ""}, 
{"定位石(100次)", 7080000, 1, ""}, 
{"修复神水(1次)", 708000000, 1, ""}, 
{"小喇叭", 1200000000, 1, ""}, 
{"中级鉴定灵符", 141600000, 1, ""}, 
}, 
{
{"斗士铠甲(男)", 2000000, 1, ""}, 
{"阎罗长袍(女)", 75000, 1, ""}, 
{"钱袋(2万)", 1500000000, 1, ""}, 
{"修复神水", 60000000, 1, ""}, 
{"汗血(未开光)", 60000000, 1, ""}, 
{"随机传送(50次)", 300000000, 1, ""}, 
{"清心丹", 300000000, 1, ""}, 
{"中级鉴定灵符", 60000000, 1, ""}, 
}, 
{
{"天劫项链", 150000, 1, ""}, 
{"云扬头盔", 10000, 1, ""}, 
{"释灵珠", 30000000, 1, ""}, 
{"定位石", 30000000, 1, ""}, 
{"汗血(未开光)", 6000000, 1, ""}, 
{"时之沙砾", 30000000, 1, ""}, 
{"玫瑰花", 300000000, 1, ""}, 
{"中级鉴定灵符", 6000000, 1, ""}, 
}, 
{
{"飞尘道靴", 9395595000, 1, ""}, 
{"太玄道袍(男)", 24725.25, 1, "s%探索天机罗盘发现了太玄道袍(男)"}, 
{"打捆绳", 469779750000, 1, ""}, 
{"99朵玫瑰花", 4745250000, 1, ""}, 
{"999朵玫瑰花", 9405000, 1, ""}, 
{"鸠王之翼(7天)", 9395595000, 1, ""}, 
{"巫山城传送石", 46977975000, 1, ""}, 
{"中级鉴定灵符", 9395595000, 1, ""}, 
}, 
{
{"血夜项链", 11988000, 1, ""}, 
{"火灵护腕(神)", 799200, 1, ""}, 
{"巫山城传送石", 2397600000, 1, ""}, 
{"低级灵元精粹", 1198800000, 1, ""}, 
{"999朵玫瑰花", 480000, 1, ""}, 
{"1.5倍经验卷轴", 2397600000, 1, ""}, 
{"钱袋(2万)", 11988000000, 1, ""}, 
{"中级鉴定灵符", 479520000, 1, ""}, 
}, 
{
{"护体道袍(女)", 118000000, 1, ""}, 
{"光明道袍(男)", 4425000, 1, ""}, 
{"小喇叭", 30000000000, 1, ""}, 
{"3倍经验卷轴", 3540000000, 1, ""}, 
{"雪域天狼(未开光)", 354000, 1, "s%探索天机罗盘发现了雪域天狼(未开光)"}, 
{"释灵珠", 17700000000, 1, ""}, 
{"开光印", 17700000000, 1, ""}, 
{"中级鉴定灵符", 3540000000, 1, ""}, 
}, 
{
{"祝福大礼包", 60000, 1, "s%探索天机罗盘发现了祝福大礼包"}, 
{"云扬护腕(圣)", 1000000, 1, ""}, 
{"巫山城传送石", 3000000000, 1, ""}, 
{"打捆绳(10个)", 3000000000, 1, ""}, 
{"雪域天狼(未开光)", 60000, 1, "s%探索天机罗盘发现了雪域天狼(未开光)"}, 
{"祝福神水", 3000000000, 1, ""}, 
{"经验丹", 30000000000, 1, ""}, 
{"中级鉴定灵符", 600000000, 1, ""}, 
}, 
{
{"圣武头盔", 210000000, 1, ""}, 
{"残虹", 500, 1, "s%探索天机罗盘发现了残虹"}, 
{"经验丹", 10500000000, 1, ""}, 
{"号角", 10500000, 1, ""}, 
{"随机传送(500次)", 10500000, 1, ""}, 
{"天藏之翼(7天)", 210000000, 1, ""}, 
{"坐骑还魂丹", 1050000000, 1, ""}, 
{"低级鉴定灵符", 1050000000, 1, ""}, 
}, 
{
{"末日头盔", 1080000, 1, ""}, 
{"疾雷戒指(神)", 72000, 1, ""}, 
{"时之沙砾", 216000000, 1, ""}, 
{"双倍经验卷轴", 108000000, 1, ""}, 
{"随机传送(500次)", 2160000, 1, ""}, 
{"开光印", 216000000, 1, ""}, 
{"9朵玫瑰花", 240000000, 1, ""}, 
{"低级鉴定灵符", 216000000, 1, ""}, 
}, 
{
{"苍冥护腕", 29500000, 1, ""}, 
{"噬空", 2950, 1, "s%探索天机罗盘发现了噬空"}, 
{"灵元精华", 737500000, 1, ""}, 
{"小喇叭(10个)", 25000000, 1, ""}, 
{"绝影(未开光)", 29500000, 1, ""}, 
{"青鸾之翼(7天)", 29500000, 1, ""}, 
{"时之沙砾", 147500000, 1, ""}, 
{"低级鉴定灵符", 147500000, 1, ""}, 
}, 
{
{"天劫道盔", 30000, 1, ""}, 
{"火灵戒指(圣)", 2000, 1, ""}, 
{"时之沙砾", 6000000, 1, ""}, 
{"打捆绳(10个)", 6000000, 1, ""}, 
{"绝影(未开光)", 1200000, 1, ""}, 
{"随机传送(50次)", 6000000, 1, ""}, 
{"钱袋(1万)", 60000000, 1, ""}, 
{"低级鉴定灵符", 6000000, 1, ""}, 
}, 
{
{"飞尘护腕", 282150000, 1, ""}, 
{"圣灵法衣(女)", 742.5, 1, "s%探索天机罗盘发现了圣灵法衣(女)"}, 
{"经验丹", 14107500000, 1, ""}, 
{"99朵玫瑰花", 142500000, 1, ""}, 
{"逍遥游(500次)", 9405000, 1, ""}, 
{"紫莺之翼(7天)", 282150000, 1, ""}, 
{"巫山城传送石", 1410750000, 1, ""}, 
{"低级鉴定灵符", 1410750000, 1, ""}, 
}, 
{
{"血夜魔盔", 360000, 1, ""}, 
{"火灵项链", 24000, 1, ""}, 
{"坐骑还魂丹", 72000000, 1, ""}, 
{"低级转神石", 36000000, 1, ""}, 
{"逍遥游(500次)", 480000, 1, ""}, 
{"钱袋(10万)", 72000000, 1, ""}, 
{"钱袋(2万)", 360000000, 1, ""}, 
{"低级鉴定灵符", 72000000, 1, ""}, 
}, 
{
{"护体道袍(男)", 23600000, 1, ""}, 
{"光明道袍(女)", 885000, 1, ""}, 
{"小喇叭", 6000000000, 1, ""}, 
{"钱袋(50万)", 708000000, 1, ""}, 
{"梦魇兽(未开光)", 70800, 1, "s%探索天机罗盘发现了梦魇兽(未开光)"}, 
{"随机传送(50次)", 3540000000, 1, ""}, 
{"开光印", 3540000000, 1, ""}, 
{"低级鉴定灵符", 3540000000, 1, ""}, 
}, 
{
{"小喇叭(100个)", 120000, 1, ""}, 
{"云扬道靴", 118000, 1, ""}, 
{"坐骑还魂丹", 354000000, 1, ""}, 
{"1.5倍经验卷轴", 354000000, 1, ""}, 
{"梦魇兽(未开光)", 7080, 1, "s%探索天机罗盘发现了梦魇兽(未开光)"}, 
{"清心丹", 354000000, 1, ""}, 
{"经验丹", 3540000000, 1, ""}, 
{"低级鉴定灵符", 354000000, 1, ""}, 
}, 
{
{"飞尘头盔", 5700000000, 1, ""}, 
{"百裂战甲(女)", 15000, 1, "s%探索天机罗盘发现了百裂战甲(女)"}, 
{"灵元珠", 285000000000, 1, ""}, 
{"号角", 285000000, 1, ""}, 
{"逍遥游(7天)", 237500000, 1, ""}, 
{"绽放之翼(7天)", 5700000000, 1, ""}, 
{"修复神水(1次)", 28500000000, 1, ""}, 
{"暴击灵符1级", 114000000, 1, ""}, 
}, 
{
{"末日护腕", 18000000, 1, ""}, 
{"疾雷戒指(圣)", 1200000, 1, ""}, 
{"清心丹", 3600000000, 1, ""}, 
{"钱袋(20万)", 1800000000, 1, ""}, 
{"逍遥游(7天)", 30000000, 1, ""}, 
{"随机传送(50次)", 3600000000, 1, ""}, 
{"钱袋(5万)", 7200000000, 1, ""}, 
{"暴击灵符1级", 14400000, 1, ""}, 
}, 
{
{"灵魂法衣(男)", 5000000, 1, ""}, 
{"赤峰战甲(女)", 187500, 1, ""}, 
{"钱袋(5万)", 1500000000, 1, ""}, 
{"3倍经验卷轴", 150000000, 1, ""}, 
{"疾风(未开光)", 150000000, 1, ""}, 
{"灵元精华", 3750000000, 1, ""}, 
{"龙城传送石", 750000000, 1, ""}, 
{"暴击灵符1级", 3000000, 1, ""}, 
}, 
{
{"天劫护腕", 750000, 1, ""}, 
{"云扬护腕(神)", 50000, 1, ""}, 
{"清心丹", 150000000, 1, ""}, 
{"钱袋(10万)", 150000000, 1, ""}, 
{"疾风(未开光)", 30000000, 1, ""}, 
{"祝福神水", 150000000, 1, ""}, 
{"灵元珠", 1500000000, 1, ""}, 
{"暴击灵符1级", 600000, 1, ""}, 
}, 
{
{"苍冥魔靴", 1500000000, 1, ""}, 
{"断空", 150000, 1, "s%探索天机罗盘发现了断空"}, 
{"灵元珠", 75000000000, 1, ""}, 
{"中级灵元精粹", 1250000000, 1, ""}, 
{"高级灵元精粹", 37500000, 1, ""}, 
{"彩灵之翼(7天)", 1500000000, 1, ""}, 
{"释灵珠", 7500000000, 1, ""}, 
{"暴击灵符1级", 30000000, 1, ""}, 
}, 
{
{"血夜护腕", 6000000, 1, ""}, 
{"火灵魔靴", 400000, 1, ""}, 
{"东临城传送石", 1200000000, 1, ""}, 
{"大型经验丹", 1200000000, 1, ""}, 
{"高级灵元精粹", 6000000, 1, ""}, 
{"清心丹", 1200000000, 1, ""}, 
{"灵元精华", 6000000000, 1, ""}, 
{"暴击灵符1级", 4800000, 1, ""}, 
}, 
{
{"天瀑", 405000000, 1, ""}, 
{"疾雷项链", 27000000, 1, ""}, 
{"9朵玫瑰花", 90000000000, 1, ""}, 
{"逍遥游(100次)", 27000000000, 1, ""}, 
{"霸下玄龟(未开光)", 1620000, 1, "s%探索天机罗盘发现了霸下玄龟(未开光)"}, 
{"大型经验丹", 81000000000, 1, ""}, 
{"东临城传送石", 81000000000, 1, ""}, 
{"暴击灵符1级", 324000000, 1, ""}, 
}, 
{
{"附魔石", 100000, 1, "s%探索天机罗盘发现了附魔石"}, 
{"乾坤囊(10格)", 25000000, 1, ""}, 
{"东临城传送石", 5000000000, 1, ""}, 
{"随机传送(50次)", 5000000000, 1, ""}, 
{"霸下玄龟(未开光)", 100000, 1, "s%探索天机罗盘发现了霸下玄龟(未开光)"}, 
{"大型经验丹", 5000000000, 1, ""}, 
{"打捆绳", 50000000000, 1, ""}, 
{"暴击灵符1级", 20000000, 1, ""}, 
}, 
}

function compare(a, b)
    return a < b
end

function GetRandomAward(player)
    local group = lualib:Player_GetCustomVarInt(player, "天机宝箱_CurGroupID")
    local max = 0
    local v = {}
    for i = 1, table.getn(AwardGroup[group]) do
        max = max + AwardGroup[group][i][2]
        v[i] = max
    end
    local times = lualib:Player_GetCustomVarInt(player, "天机宝箱_times")
    local r_off = 0
    local selected = {}

    for i = 1, times do
        selected[i] = lualib:Player_GetCustomVarInt(player, "天机宝箱_Sel_"..i)
        r_off = r_off + AwardGroup[group][selected[i]][2]
    end

    table.sort(selected, compare)

    local r = lualib:GenRandom(1, max - r_off)

    for i = 1,times do
        if r > v[selected[i]] - AwardGroup[group][selected[i]][2] then
            r = r + AwardGroup[group][selected[i]][2]
        end
    end

    local sel = 8
    for i = 1, table.getn(v) do
        if r <= v[i] then
            sel = i
            break
        end
    end

    return sel
end

-- showtype 1、播放动画 0、直接显示
function notify_award(player, showtype)
    local group = lualib:Player_GetCustomVarInt(player, "天机宝箱_CurGroupID")
    local times = lualib:Player_GetCustomVarInt(player, "天机宝箱_times")
    local content = ""
    local max = table.getn(AwardGroup[group])
    for j = 1, max do
        content = content..AwardGroup[group][j][1].."["..AwardGroup[group][j][3].."],"
    end
    content = content.."\n"

    local t = 0
    for i = 1,times do
        var = "天机宝箱_Sel_"..i
        local lastsel = lualib:Player_GetCustomVarInt(player, var)
        content = content..lastsel..","
    end
    content = content.."\n"..showtype

    content = content.."\n"..lualib:Player_GetCustomVarInt(player, "天机宝箱_HasAward")
    lualib:Print(content)
    lualib:ShowFormWithContent(player, "天机宝箱大转盘", content)
end
